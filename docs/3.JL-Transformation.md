## JL-Transformation

[toc]

Johnson-Lindenstrauss.

#### JL 引理
(**Johnson-Lindenstrauss Lemma**) 给定一个点集 $P\subset R^d$, $|P|=n$, 对 $\forall \epsilon\in(0,1)$, 令 $k=O(\frac{logn}{\epsilon^2})$, 存在一个线性变换 $f:R^d\rightarrow R^k$, s.t. $\forall u,v\in P$, $$(1-\epsilon)\|u-v\|^2\le\|f(u)-f(v)\|^2\le(1+\epsilon)\|u-v\|^2$$

#### 实现

令 $A\in R^{k\times d}$, A中每个元素服从 $\mathcal{N}(0,1)$, A 是个随机矩阵.

让 $f=\frac{1}{\sqrt{k}}A$, 称作 JL-Transform
$A=\left[\begin{array}{c}
A_1\\A_2\\\vdots\\A_k
\end{array}\right]$, $\forall A_j=[A_{j1},\cdots,A_{jd}]$

$\forall x\in R^d$, 考虑 $y=\frac{1}{\sqrt{k}}Ax$

1. 期望不变:
$\begin{aligned}
E[\|y\|^2]&=\frac{1}{k}E[\|Ax\|^2]\\
&=\frac{1}{k}\sum\limits_{j=1}^kE[(A_jx)^2]\\
&=E\left[\sum\limits_{1\le i,i'\le d}A_{ji}A_{ji'}x_ix_{i'}\right]\\
&=E\left[\sum\limits_{i=1}^dA_{ji}^2x_i^2\right]\\
&=\sum\limits_{i=1}^dx_i^2=\|x\|^2
\end{aligned}$
2. 定义$z_j=\frac{A_jx}{\|x\|}=\sum\limits_{i=1}^d\frac{A_{ji}x_i}{\|x\|}$, 则 $z_j\sim\mathcal{N}(0,1)$
$\begin{aligned}
Pr\left[\|y\|^2>(1+\epsilon)\|x\|^2\right]&=Pr\left[\frac{\|Ax\|^2}{\|x\|^2}>(1+\epsilon)k\right]\\
&=Pr\left[\sum\limits_{j=1}^kz_j^2>(1+\epsilon)k\right]\\
&=Pr\left[e^{\lambda\sum\limits_{j=1}^kz_j^2}>e^{(1+\epsilon)k\lambda}\right]\\
&\le\frac{1}{e^{(1+\epsilon)k\lambda}}E[e^{\lambda\sum\limits_{j=1}^kz_j^2}] (Markov's)\\
&=\frac{1}{e^{(1+\epsilon)k\lambda}}\prod\limits_{j=1}^kE[e^{\lambda z_j^2}]\\
&=\frac{1}{e^{(1+\epsilon)k\lambda}}\left(\frac{1}{1-2\lambda}\right)^{k/2} (积分可得)\\
(令\lambda=\frac{\epsilon}{2(1+\epsilon)})&=\left((1+\epsilon)e^{-\epsilon}\right)^{k/2}\\
&\le e^{-k(\epsilon^2-\epsilon^3)/4}
\end{aligned}$
同理 $$Pr\left[\|y\|^2<(1+\epsilon)\|x\|^2\right]< e^{-k(\epsilon^2-\epsilon^3)/4}$$
故
$$Pr\left[\|y\|^2\in (1\pm\epsilon)\|x\|^2\right]< 1-2e^{-k(\epsilon^2-\epsilon^3)/4}$$
要同时让 $C_n^2$ 个向量满足这个不等式, 则
$$成功概率>1-2C_n^2e^{-k(\epsilon^2-\epsilon^3)/4}试图使之>1-1/n$$
#### 复杂度
$O(nd\frac{logn}{\epsilon^2})$
$\Omega(\frac{log n}{\epsilon^2loglogn})$
#### 用途
- 分布式计算: 相同随机种子能生成相同矩阵
- 流数据:
- 隐私保护: 微小偏移
#### 问题
- A 是稠密矩阵

#### 应用中的构造法

- 直接采用 $\mathcal{N}(0,1)$ 的分布采样构造 A, 得到的矩阵会很稠密, 我们希望能比较稀疏.

##### Database-Friendly:

- $A_{ij}=\left\{\begin{array}{ll}+1 & 1/2概率\\-1 & 1/2 概率\end{array}\right.$
- $A_{ij}=\left\{\begin{array}{ll}+1 & 1/6概率\\0 & 2/3概率 \\-1 & 1/6 概率\end{array}\right.$

##### Fast JL-Transform(FJLT)

$\Phi=P\cdot H\cdot D$

- $P\in R^{k\times d}$, $P_{ij}=\left\{\begin{array}{l}\mathcal{N}(0,1/q)\sim q\\0 \sim 1-q \end{array}\right.$
这里 $q=\min\left\{\Theta(\frac{\log n^2}{d}),1\right\}$ 
  - P 的非零值有 $kdq=kd\Theta(\frac{\log n^2}{d})=\theta(k\log n^2)\ll kd$
- H 是 Hadamard 矩阵, $H_1=[1]$, $H_2=\left[\begin{array}{cc}1&1\\1&-1\end{array}\right]$,$\cdots$,$H_{2^h}=\left[\begin{array}{cc}H_{2^{h-1}}&H_{2^{h-1}}\\H_{2^{h-1}}&-H_{2^{h-1}}\end{array}\right]$.
  - 计算 $H_{2^h}x$ 可以令 $x=\left[\begin{array}{c}x_1\\x_2\end{array}\right]$, 从而 $$H_{2^h}x=\left[\begin{array}{c}H_{2^{h-1}}x_1+H_{2^{h-1}}x_2 \\ H_{2^{h-1}}x_1-H_{2^{h-1}}x_2\end{array}\right]$$
  - 根据这样的算法, $\tau(d)=2\tau(d/2)+O(d)=O(d\log d)$
- $D=\left[\begin{array}{ccc}\pm 1&&0\\&\ddots&\\0&&\pm 1\end{array}\right]$, 其中$\pm1$ 的概率均为 $\frac{1}{2}$.

总复杂度: $O\left(n(d\log d+\frac{\log n^2}{d}\cdot\frac{\log n}{\epsilon^2}\cdot d)\right)=O(n(d+\frac{1}{\epsilon^2}))$

